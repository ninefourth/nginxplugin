功能：
这是一个对nginx做的端点模块，用于对外暴露restful，方便外部程序在不重启nginx的情况下干预nginx的行为(通过其它模块，而不是在本模块内做处理，本模块只是提供端点和调用其它功能模块)

做如下配置，使端点对外暴露
server {
        listen 8100;
        server_name 192.168.7.233 127.0.0.1;
        location / {
            endpoint;
        }
    }

目前完成的功能
一.列出所有upstream
http://192.168.7.233:8100/list
    upstream store {
     server 192.168.7.105:8082 name=0 weight=2 down=0
     server 192.168.7.205:8085 name=1 weight=2 down=0
    }
    upstream store1 {
     server 192.168.7.105:8082 name=0 weight=2 down=0
     server 192.168.7.205:8085 name=1 weight=2 down=0
    }
返回结果里，name是唯一名称，摘挂server使用此值；down表示server的状态;weight表示服务器权重

二. 动态摘挂upstream的server，注意必须在配置文件的upstream中使用 xfdf_ip_hash(ngx_xfdf_ip_hash_module)
#摘掉server /down/{upstream_name}/{server_name}
http://192.168.7.233:8100/down/store1/0
#摘掉server /down/{upstream_name}/{server_name}　有日志记录
http://192.168.7.233:8100/down/store1/0/log

#挂载server /up/{upstream_name}/{server_name}
http://192.168.7.233:8100/up/store1/0

三.动态设置服务器负载权重
#设置权重 /weight/{upstream_name}/{server_name}/{权重数值}
http://192.168.27.74:8100/weight/store1/1/2

四.添加灰度及测试列表
#重新载入测试访问列表,conf参数值是列表配置文件地址名称
http://192.168.27.74:8100/fortest?conf=conf/test.conf
#重新载入灰度访问列表,conf参数值是列表配置文件地址名称
http://192.168.27.74:8100/forgray?conf=conf/gray.conf
#列出测试访问列表的哈希内容
http://192.168.27.74:8100/listtest
#列出灰度访问列表的哈希内容
http://192.168.27.74:8100/listgray

灰度/测试访问列表内容格式如下：
#每一段的变量名同nginx中的变量一至
# - 匹配$host变量的值，即是服务器地址
[host]
www.fxscm.net.cn
fxscm.net
# - 匹配$remote_addr变量的值，即是直接客户端ip
[remote_addr]
137.0.0.1
# - 匹配消息头中变量a的值
[http_a]
aa
# - 匹配get地址中的参数a的值
[arg_a]
ab

#在nginx.conf文件中将需要灰度或测试的地方加入变量判断为1即可（变量名对应 $forgray 与 $fortest），如：
set $psurl http://appupstream;
if ( $fortest = 1 ){
    set $psurl http://test_appupstream;
}
if ( $forgray = 1 ){
    set $psurl http://gray_appupstream;
}
